#!/usr/bin/env ruby
# frozen_string_literal: true

changed_files = `git diff --name-only origin/master | grep 'lib/html2rss/configs/.*/.*.yml'`.split("\n")

if changed_files.count.positive?
  # Use dynamic test file with environment variable to filter changed configs
  config_names = changed_files.map { |file| file.sub('lib/html2rss/configs/', '') }

  # Test each changed config individually
  config_names.each do |config_name|
    puts "Testing changed config: #{config_name}"
    system("bundle exec rspec --example '#{config_name}' --tag fetch spec/html2rss/configs_dynamic_spec.rb")
  end
else
  puts 'No changed config files found'
  exit 0
end
